<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Lab Assignment 8 | GEOG 4046 Web GIS</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' type='text/css'>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/open-iconic/1.1.1/font/css/open-iconic-bootstrap.min.css">
    <link rel="stylesheet" href="/css/cayman.css">
    <link rel="stylesheet" href="/css/style.css">
  </head>
  <body>
    <section class="page-header">
      <div class="shadebox">
        <h1 class="project-name"><a href="/">GEOG 4046</a></h1>
        <h2 class="project-tagline">An Introduction to Web GIS</h2>
        <div class="text-center">
          <a href="/">Syllabus</a> |
          <a href="/assignments">Assignments</a> |
          <a href="/notes">Notes</a> |
          <a href="/schedule">Schedule and Due Dates</a>
        </div>
      </div>
    </section>
    <section class="main-menu">

    </section>

    <section class="main-content">
      <h1 class="text-center">Lab Assignment 8</h1>
      <h2 class="text-center">Web Services with Leaflet</h2>
      <p>Create a web map using Leaflet and overlay a Web Map Service (WMS) layer over a basemap.</p>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" />

<div id="map2" style="height:250px"></div>
<script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"></script>

<script src="../../assignment-resources/js/map2.js"></script>

<p><small>Real-time precipitation and weather warnings (by county) displayed over the OpenStreetMap basemap.</small></p>

<h2 id="process">Process</h2>
<ol>
  <li>
    <p>Instead of creating a new project from scratch, copy the previous assignment’s folder and rename it to <code class="highlighter-rouge">map2</code>. Rename the previous <code class="highlighter-rouge">.js</code> file to <code class="highlighter-rouge">map2.js</code> and update the <code class="highlighter-rouge">script</code> tag in <code class="highlighter-rouge">index.html</code> to use the new <code class="highlighter-rouge">map2.js</code>. Do the same for the <code class="highlighter-rouge">.css</code> file.<br />
<img src="../../assignment-resources/images/atom-duplicate.png" alt="Atom duplicate folder" /><br />
<img src="../../assignment-resources/images/atom-dup-name.png" alt="Atom duplicate folder name" /><br />
<img src="../../assignment-resources/images/atom-rename.png" alt="Atom rename" /></p>
  </li>
  <li>
    <p>In the JavaScript file, delete the parts from the previous assignment that created the points, lines, polygons, and popups, but leave the basemap. You will start adding the code for this assignment on the line below where you created the basemap layer in the previous assignment.</p>
  </li>
  <li>
    <p>Use the <code class="highlighter-rouge">L.tileLayer.wms</code> method, giving it two parameters: a URL and an options object.</p>

    <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">L</span><span class="p">.</span><span class="nx">tileLayer</span><span class="p">.</span><span class="nx">wms</span><span class="p">(</span><span class="s1">'http://mesonet.agron.iastate.edu/cgi-bin/wms/nexrad/n0r.cgi'</span><span class="p">,</span> <span class="p">{</span>
  <span class="na">layers</span><span class="p">:</span> <span class="s1">'nexrad-n0r-900913'</span><span class="p">,</span>
  <span class="na">format</span><span class="p">:</span> <span class="s1">'image/png'</span><span class="p">,</span>
  <span class="na">transparent</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="na">attribution</span><span class="p">:</span> <span class="s1">'NOAA, Iowa State University'</span>
<span class="p">}).</span><span class="nx">addTo</span><span class="p">(</span><span class="nx">renameThisMap</span><span class="p">)</span>
</code></pre></div>    </div>
    <p>The <code class="highlighter-rouge">format</code> and <code class="highlighter-rouge">transparent</code> properties might not be necessary for every WMS layer, but with this radar example, they prevent the appearance of a white background.</p>
  </li>
  <li>
    <p>Adjust the map properties to center and zoom the map on your layer.</p>
  </li>
  <li>
    <p>Set a basemap that complements your WMS layer.</p>
  </li>
  <li>
    <p><strong>Try it</strong>: add a second layer (counties currently under a weather warning). For the <code class="highlighter-rouge">layers</code> property, set the value to <code class="highlighter-rouge">warnings_c</code>. For the URL use <code class="highlighter-rouge">https://mesonet.agron.iastate.edu/cgi-bin/wms/us/wwa.cgi</code></p>
  </li>
</ol>

<h2 id="requirements">Requirements</h2>
<ol>
  <li>General best practices:<br />
  a. Scripts and styles in separate files<br />
  b. Your own page title<br />
  c. Proper indentation<br />
  d. No errors in the console</li>
  <li>A basemap</li>
  <li>Appropriate zoom and center</li>
  <li>Rename variables and functions to something descriptive</li>
</ol>

<h2 id="submit">Submit</h2>
<ol>
  <li>The URL to your map page: <code class="highlighter-rouge">https://yourname.github.io/map2</code></li>
</ol>

<h2 id="appendix">Appendix</h2>

<h3 id="use-an-arcgis-service-as-wms">Use an ArcGIS service as WMS</h3>
<p>Many ArcGIS web services support WMS and can be used with Leaflet without needing a third-party plugin. For example, see those on the NOAA nowCOAST website’s <a href="https://nowcoast.noaa.gov/help/#!section=map-service-list">layer list</a>. A WMS URL from an ArcGIS Server will have <code class="highlighter-rouge">/MapServer/WMSServer</code> on the end and it will not contain <code class="highlighter-rouge">/rest</code>. For example compare the ArcGIS REST Service URL and the WMS URL for a national weather radar layer:</p>
<h4 id="rest">REST:</h4>
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://nowcoast.noaa.gov/arcgis/rest/services/nowcoast/radar_meteo_imagery_nexrad_time/MapServer  
</code></pre></div></div>
<h4 id="wms">WMS:</h4>
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://nowcoast.noaa.gov/arcgis/services/nowcoast/radar_meteo_imagery_nexrad_time/MapServer/WMSServer  
</code></pre></div></div>
<p>In addition to the WMS URL, Leaflet will need to know the layer number. This number is different from the number given on the ArcGIS service details page, and the process for finding it is not as easy. See this <a href="https://nowcoast.noaa.gov/help/#!section=wms-layer-ids">article from NOAA</a> for an explanation. For the radar layer given above, the layer number is <code class="highlighter-rouge">1</code>.</p>

<p>The URL, layer ID, and other parameters can be passed to the <code class="highlighter-rouge">L.tileLayer.wms</code> method:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">L</span><span class="p">.</span><span class="nx">tileLayer</span><span class="p">.</span><span class="nx">wms</span><span class="p">(</span><span class="s1">'https://nowcoast.noaa.gov/arcgis/services/nowcoast/radar_meteo_imagery_nexrad_time/MapServer/WMSServer'</span><span class="p">,</span> <span class="p">{</span>
  <span class="na">layers</span><span class="p">:</span> <span class="s1">'1'</span><span class="p">,</span>
  <span class="na">format</span><span class="p">:</span> <span class="s1">'image/png'</span><span class="p">,</span>
  <span class="na">transparent</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="na">attribution</span><span class="p">:</span> <span class="s1">'NOAA'</span>
<span class="p">}).</span><span class="nx">addTo</span><span class="p">(</span><span class="nx">renameThisMap</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="use-the-esri-leaflet-plugin-to-display-arcgis-services">Use the esri-leaflet plugin to display ArcGIS services</h3>
<p>The capabilities of Leaflet can be extended with third-party plugins, such as <a href="https://esri.github.io/esri-leaflet/examples">esri-leaflet</a>. This plugin is especially useful for working with layers published to ArcGIS Online and ArcGIS Enterprise. The get started, add a reference to the esri-leaflet library in the <code class="highlighter-rouge">head</code> of your <code class="highlighter-rouge">index.html</code>, <strong>under</strong> Leaflet’s <code class="highlighter-rouge">script</code> tag:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"https://unpkg.com/esri-leaflet@2.3.2/dist/esri-leaflet.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
</code></pre></div></div>

<p>Then in your JavaScript file, after the <code class="highlighter-rouge">map</code> object is created, use the <code class="highlighter-rouge">L.esri.dynamicMapLayer</code> method to add a layer from a REST URL:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">L</span><span class="p">.</span><span class="nx">esri</span><span class="p">.</span><span class="nx">dynamicMapLayer</span><span class="p">({</span>
  <span class="na">url</span><span class="p">:</span> <span class="s1">'https://nowcoast.noaa.gov/arcgis/rest/services/nowcoast/radar_meteo_imagery_nexrad_time/MapServer'</span>
<span class="p">}).</span><span class="nx">addTo</span><span class="p">(</span><span class="nx">renameThisMap</span><span class="p">)</span>
</code></pre></div></div>

    </section>
<footer class="site-footer">
  
</footer>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js"></script>
</body>
</html>

